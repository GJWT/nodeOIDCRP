<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: oauth2/init.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: oauth2/init.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const CLIENT_AUTHN_METHOD =
    require('../clientAuth/privateKeyJWT').CLIENT_AUTHN_METHOD;
const ClientInfo = require('../clientInfo.js');
const Factory = require('../oauth2/service/service').Factory;
const HTTPLib = require('../http').HTTPLib;
const KeyJar = require('../../nodeOIDCMsg/src/oicMsg/keystore/KeyJar');
const OicCliError = require('../exception').OicCliError;
const Service = require('../service');

const DEFAULT_SERVICES = [
  'Authorization', 'AccessToken', 'RefreshAccessToken', 'ProviderInfoDiscovery'
];

/**
 * Takes a dictionary with a reference to which service subclass that should be 
 * instantiated as key and specific service configuration for that instance as 
 * value.
 * @param {Object&lt;string, object>} srvs Service subclass as key and configuration as value
 * @param {function} serviceFactory OIC/ OAuth2 factory method 
 * @param {KeyJar} keyJar OIDCMsg KeyJar instance that contains the RP signing and encyrpting keys
 * @param {string} clientAuthnMethod One of the six client authentication methods
 * @return A dictionary containing the necessary services and their instances
 */
function buildServices(srvs, serviceFactory, keyJar, clientAuthnMethod) {
  let http = kwargs['httpLib'];
  let keyJar = kwargs['keyJar'];
  let clientAuthnMethod = kwargs['clientAuthnMethod'];
  let service = {};
  for (let i = 0; i &lt; srvs.length; i++) {
    let serv = srvs[i];
    let srv = serviceFactory(serv, http, keyJar, clientAuthnMethod);
    let name = srv.prototype.request || srv.name;
    service[name] = srv;
    let newServ = new Service();
    service['any'] = newServ.init(http, keyJar, clientAuthnMethod);
  }
  return service;
}

/**
 * Client
 * @class
 * @constructor
 */
class Client {
  /**
   * @param {*} caCerts Certificates used to verify HTTPS certificates
   * @param {*} clientAuthnMethod Methods that this client can use to
          authenticate itself. It's a dictionary with method names as
          keys and method classes as values.
   * @param {*} verifySsl Whether the SSL certificate should be verified.
   */
  constructor(
      clientAuthnMethod, config, caCerts, keyJar, verifySsl, clientCert,
      httpLib, services, serviceFactory) {
    caCerts = caCerts || null;
    clientAuthnMethod = clientAuthnMethod || null;
    keyJar = keyJar || null;
    verifySsl = verifySsl || true;
    config = config || null;
    clientCert = clientCert || null;
    httpLib = httpLib || null;
    services = services || null;
    serviceFactory = serviceFactory || null;

    this.http = httpLib || new HTTPLib(caCerts, verifySsl, clientCert, keyJar);

    if (!keyJar) {
      let keyJar = new KeyJar();
    }

    this.events = null;
    let clientInfo = new ClientInfo();
    this.clientInfo = clientInfo.init(keyJar, config);
    if (this.clientInfo.clientId) {
      this.clientId = this.clientInfo.clientId;
    }
    let cam = clientAuthnMethod || CLIENT_AUTHN_METHOD;
    this.serviceFactory = serviceFactory || Factory;
    let srvs = services || this.getDefaultServices();
    this.service = buildServices(
        srvs, this.serviceFactory,
        {'httpLib': this.http, 'keyJar': keyJar, 'clientAuthnMethod': cam});
    this.clientInfo.service = this.service;
    this.verifySsl = verifySsl;
  }

  /**
   * Performs request for AccessToken Service and parses the returned response
   * @param {ClientInfo} cliInfo Client information
   * @param {string} bodyType Which serialization to use for the HTTP body
   * @param {string} method HTTP method used
   * @param {string} authMethod One of the six client authentication methods
   * @param {Object&lt;string, string>} requestArgs Message arguments
   * @param {Object&lt;string, object>} httpArgs Initial HTTP header arguments
   * @returns Returns the parsed response returned from the AccessToken service request
   */
  accessTokenRequest(cliInfo, bodyType, method, authMethod, requestArgs, httpArgs){
  };

  /**
   * Performs request for Authorization Service and parses the returned response
   * @param {ClientInfo} cliInfo Client information
   * @param {string} bodyType Which serialization to use for the HTTP body
   * @param {string} method HTTP method used
   * @param {string} authMethod One of the six client authentication methods
   * @param {Object&lt;string, string>} requestArgs Message arguments
   * @param {Object&lt;string, object>} httpArgs Initial HTTP header arguments
   * @returns Returns the parsed response returned from the Authorization service request
   */
  authorize(cliInfo, bodyType, method, authMethod, requestArgs, httpArgs){
  };

  /**
   * Performs request for RefreshAccessToken Service and parses the returned response
   * @param {ClientInfo} cliInfo Client information
   * @param {string} bodyType Which serialization to use for the HTTP body
   * @param {string} method HTTP method used
   * @param {string} authMethod One of the six client authentication methods
   * @param {Object&lt;string, string>} requestArgs Message arguments
   * @param {Object&lt;string, object>} httpArgs Initial HTTP header arguments
   * @returns Returns the parsed response returned from the RefreshAccessToken service request
   */
  refreshAccessTokenRequest(cliInfo, bodyType, method, authMethod, requestArgs, httpArgs){
  };

  /**
   * Performs request for ProviderInfo Service and parses the returned response
   * @param {ClientInfo} cliInfo Client information
   * @param {string} bodyType Which serialization to use for the HTTP body
   * @param {string} method HTTP method used
   * @param {string} authMethod One of the six client authentication methods
   * @param {Object&lt;string, string>} requestArgs Message arguments
   * @param {Object&lt;string, object>} httpArgs Initial HTTP header arguments
   * @returns Returns the parsed response returned from the ProviderInfo service request
   */
  discoverProviderInfo(cliInfo, bodyType, method, authMethod, requestArgs, httpArgs){
  }

  construct(requestType, requestArgs, extraArgs, kwargs) {
    requestArgs = requestArgs || null;
    extraArgs = extraArgs || null;
    try {
      this.service[requestType];
    } catch (err) {
      console.log(err);
    }
    let met = this.getAttr('construct_{}_request'.format(requestType));
    return met(this.clientInfo, requestArgs, extraArgs, kwargs);
  }

  doRequest(
      requestType, scope, responseBodyType, method, requestArgs, extraArgs,
      httpArgs, authnMethod, kwargs) {
    scope = scope || '';
    responseBodyType = responseBodyType || '';
    method = method || '';
    requestArgs = requestArgs || null;
    extraArgs = extraArgs || null;
    httpArgs = httpArgs || null;
    authnMethod = authnMethod | '';

    let srv = this.service[requestType];
    if (!method) {
      method = srv.httpMethod;
    }
    let info = srv.doRequestInit(
        this.clientInfo, method, scope, requestArgs, extraArgs, authnMethod,
        httpArgs, kwargs);

    if (!responseBodyType) {
      responseBodyType = srv.responseBodyType;
    }

    let body = null;
    try {
      body = info['body'];
    } catch (err) {
      console.log(err);
      vbody = null;
    }
    return srv.serviceRequest(
        info['uri'], method, body, requestBodyType, info['httpArgs'],
        this.clientInfo, kwargs);
  }

  setClientId(clientId) {
    this.clientId = clientId;
    this.clientInfo.clientId = clientId;
  }

  getDefaultServices() {
    return DEFAULT_SERVICES;
  }
}

module.exports.Client = Client;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AccessToken.html">AccessToken</a></li><li><a href="Authorization.html">Authorization</a></li><li><a href="BearerBody.html">BearerBody</a></li><li><a href="BearerHeader.html">BearerHeader</a></li><li><a href="CheckID.html">CheckID</a></li><li><a href="CheckSession.html">CheckSession</a></li><li><a href="Client.html">Client</a></li><li><a href="ClientAuthnMethod.html">ClientAuthnMethod</a></li><li><a href="ClientInfo.html">ClientInfo</a></li><li><a href="ClientSecretBasic.html">ClientSecretBasic</a></li><li><a href="ClientSecretJWT.html">ClientSecretJWT</a></li><li><a href="ClientSecretPost.html">ClientSecretPost</a></li><li><a href="EndSession.html">EndSession</a></li><li><a href="JRD.html">JRD</a></li><li><a href="JWSAuthnMethod.html">JWSAuthnMethod</a></li><li><a href="LINK.html">LINK</a></li><li><a href="OICCli.html">OICCli</a></li><li><a href="ProviderInfoDiscovery.html">ProviderInfoDiscovery</a></li><li><a href="RefreshAccessToken.html">RefreshAccessToken</a></li><li><a href="Registration.html">Registration</a></li><li><a href="Service.html">Service</a></li><li><a href="State.html">State</a></li><li><a href="StateJWT.html">StateJWT</a></li><li><a href="URINormalizer.html">URINormalizer</a></li><li><a href="UserInfo.html">UserInfo</a></li><li><a href="Util.html">Util</a></li><li><a href="WebFinger.html">WebFinger</a></li></ul><h3>Global</h3><ul><li><a href="global.html#buildServices">buildServices</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Fri Mar 09 2018 11:36:25 GMT-0800 (PST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
